---

// Función para obtener los datos de actividades desde la API de Strava
const fetchActivities = async () => {
  const res = await fetch('https://www.strava.com/api/v3/athlete/activities', {
    headers: {
      Authorization: `Bearer ${import.meta.env.STRAVA_ACCESS_TOKEN}`, // Aquí usas tu token de Strava
    },
  });
  
  const data = await res.json();
  return data;
};

// Almacenar las actividades en una variable
let activities = [];
try {
  activities = await fetchActivities();
} catch (err) {
  console.error("Error fetching Strava activities:", err);
}

const oneWeekAgo = new Date();
oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

const recentActivities = activities.filter(activity => {
  const activityDate = new Date(activity.start_date); // Asegúrate de que activity.date sea una fecha válida
  return activityDate >= oneWeekAgo;
});

const totalDistance = recentActivities.reduce((accumulator, activity) => {
  return accumulator + activity.distance;
}, 0);

---

<!-- Renderizamos las actividades en la página -->
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Quique Ciria</title>
        <meta name="description" content="tags, tags" />
        <link href="https://fonts.googleapis.com/css?family=Chivo:200,300,400&display=swap" rel="stylesheet">
    </head>

  <body class="mx-10 my-10 font-sans text-slate-800">
    <p class="text-xl">Actividades Recientes en Strava</p>
    <p class="mt-4 text-gray-500">La distancia total de los últimos 7 días es:</p>
    <p class="text-6xl text-orange-600 mt-4"> {(totalDistance / 1000).toFixed(2)} km</p></br>

    {activities.length > 0 ? (
      <ul>
        {activities.slice(0, 3).map((activity) => (
          <li class="border-2 mt-2 p-4 border-orange-200 rounded-xl max-w-xl" key={activity.id}>
            <strong>{activity.name}</strong> - {(activity.distance / 1000).toFixed(2)} km - {(activity.moving_time / 3600).toFixed(2)} Horas - {new Date(activity.start_date).getDate()}/{new Date(activity.start_date).getMonth() + 1}
          </li>
        ))}
      </ul>
    ) : (
      <p>No se encontraron actividades.</p>
    )}
  </body>
</html>
