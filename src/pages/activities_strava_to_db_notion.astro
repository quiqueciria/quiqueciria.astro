---
import '../styles/styles.css';
import { Image } from "astro:assets";
---

<html>
  <head>
    <meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quique Ciria</title>
    <meta name="description" content="strava, notion, postman" />
    <link href="https://fonts.googleapis.com/css?family=Chivo:200,300,400&display=swap" rel="stylesheet">
</head>

  <body class="mx-10 my-10 max-w-3xl font-sans text-slate-800 bg-stone-100">
    <div class="">
   <a href="/"><img src="/imgs/arrow-left.svg"></a>
    </div>
    <div class="text-5xl mt-10 mb-10">
      Pintar tu datos de Strava en una tabla en Notion
    </div>
    <div class="text-3xl pt-8">Introducci√≥n</div>
  <div class="text-xl pt-4 pb-4 font-extralight">Este es el segundo post de la serie <strong> <a href="/activities_strava_to_notion">Controla tu Strava con Notion</a></strong>. En esta parte vamos a contar como podemos visualizar los datos de nuestras actividades que ya hemos obtenido de Strava en una base de datos en Notion.
  </div>
  <div class="text-xl pb-8 font-extralight">Son dos pasos los que hay que hacer, por un lado, crear una <strong>integraci√≥n en Notion</strong> y la <strong>base de datos</strong>; y por otro lado el <strong>script en javascrit</strong> para ejecutarlo.</div>
  <div class="text-xl">Esta serie son tres posts divididos en las siguientes partes:</div>
  <div class="text-xl pt-4 ml-8 font-extralight">
    <ul class="list-disc">
    <li class="mb-3"><a href="/activities_strava_to_notion"> API de Strava y obtenci√≥n de datos de las actividades.</a></li>
    <li class="mb-3">Pintar los datos obtenidos de Strava en una tabla de Notion <code class="bg-green-200">actual</code></li>
    <li class="mb-3">Automatizar la sincronizaci√≥n con GitHub Action <code class="bg-orange-200">pendiente</code></li>
    </ul>
  </div>
  <div class="text-3xl pt-8">Integraci√≥n en Notion</div>
  <div class="text-2xl pt-4">1. Crear una integraci√≥n en Notion:</div>
  <ul class="text-xl list-disc pt-4 ml-8 font-extralight">
    <li class="pb-2">Ve a <a href="https://www.notion.so/profile/integrations" target="_blank"> My Integrations</a>, puedes hacerlo desde tus setting o en el link anterior.</li>
    <li class="pb-2">Haz clic en "New integration".</li>
    <li class="pb-2">Asigna un nombre a tu integraci√≥n (por ejemplo, "Sync Strava Notion").</li>
    <li class="pb-2">Selecciona el espacio de trabajo al que deseas conectar la integraci√≥n.</li>
    <li class="pb-2">Elige los permisos que necesitas (por ejemplo, <code>Insertar contenido</code> y <code>Leer contenido</code>).</li>
    <li class="pb-2">Haz clic en "Submit" para crear la integraci√≥n.</li>
  </ul>
  <div class="text-2xl pt-8">2. Obt√©n el Access Token de Notion:</div>
  <ul class="text-xl list-disc pt-4 ml-8 font-extralight">
    <li class="pb-2">Una vez creada la integraci√≥n, ver√°s un "Internal Integration Secret" en la p√°gina. Este es tu <code>access_token</code> en Notion.</li>
    <li class="pb-2">Copia y guarda el token en un lugar seguro, ya que es necesario para hacer solicitudes a la API de Notion.</li>
  </ul>
  <div class="text-2xl pt-8">3. Crea la base datos:</div>
  <ul class="text-xl list-disc pt-4 ml-8 font-extralight">
    <li class="pb-2">Crea una nueva base de datos en una p√°gina nueva</li>
    <li class="pb-2">Adem√°s del campo <code>Name</code> a√±ade las propiedadades <code>Distance</code> y <code>Date</code> que son las que tenemos en el c√≥digo.</li>
    <li class="pb-2">Aj√∫stalas de la siguiente manera:</li>
    <li class="pb-2 ml-2 list-none">‚àò <code>Distance</code>: Esta propiedad debe ser del tipo N√∫mero (Number).</li>
    <li class="pb-2 ml-2 list-none">‚àò <code>Date</code>: Esta propiedad debe ser del tipo Fecha (Date).</li>
  </ul>
  <div class="text-2xl pt-8">4. Comparte tu base de datos de Notion con la integraci√≥n:</div>
  <ul class="text-xl list-disc pt-4 ml-8 font-extralight">
    <li class="pb-2">Abre la base de datos en Notion donde deseas que se inserten los datos de las actividades.</li>
    <li class="pb-2">Haz clic en los tres puntitos del men√∫ en la parte superior derecha de la p√°gina de la base de datos y baja hasta ‚ÄúConnections‚Äù .</li>
    <li class="pb-2">Busca el nombre de tu integraci√≥n y act√≠vala.</li>
    <li class="pb-2">Aseg√∫rate de que la integraci√≥n tenga acceso completo para poder escribir en la base de datos.</li>
  </ul>
  <div class="text-3xl pt-8">Script en javacript para ejecutar con Node</div>
  <div class="text-xl pt-4 font-extralight">Ahora vamos a hacer el proyecto en nuestra computadora para poder ejecutar la lectura de datos de Strava y pintarlos en Notion.</div>
  <div class="text-2xl pt-8">Instalaci√≥n de Node.js y dependencias:</div>
  <ul class="text-xl list-none pt-4 font-extralight">
    <li class="pb-2">1. Instala Node.js en tu computadora si no lo tienes.</li>
    <li class="">2. Crea un nuevo proyecto y a√±ade las dependencias</li>
    <li class="ml-4 pb-4 pt-4"><div class="code_block">
        mkdir strava-notion</br>
        cd strava-notion</br>
        npm init -y</br>
        npm install axios @notionhq/client</div></li>
    <li class="pb-2">3. Crea un archivo dentro de la carpeta con el siguiente c√≥digo y n√≥mbralo por ejemplo como <code>sync-strava.js</code></li>
    <li class=" ml-4 pb-2 pt-2"><iframe style="width:100%; height: 1090px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Fquiqueciria%2Fcode-blocks%2Fblob%2Fmain%2Fsync-strava-post.js&style=default&type=code&showBorder=on&showLineNumbers=on&showFileMeta=on&showFullPath=on&showCopy=on"></iframe></li>
    <li class="pb-4">4. Sustituye cada texto de la configuraci√≥n por los tuyos propios.</li>
    <li class=" ml-4 pb-4"><div class="p-4 bg-gray-200 font-extralight rounded-lg">Si no encuentras el c√≥digo de <code>NOTION_DATABASE_ID</code> este est√° cuando pulsas sobre el nombre de la tabla y pinchas en ‚ÄúCopy link to view‚Äù. En la URL que nos dar√°, nos quedamos con el n√∫mero que hay antes de <code>?v=</code>, por ejemplo: <code>137ad089a85b80caab69f15ecbc01e9b</code>.</div></li>
    <li class="pb-2">5. Guarda el archivo y desde el terminal ejec√∫talo:</li>
    <li class=" ml-4 pb-2"><div class="code_block">node sync_strava_notion.js</div></li>
    <li class="pb-2">6. Ahora, si todo ha ido bien, se deber√≠an de haber cargado las actividades en la base de datos de Notion.</li>
  </ul>
  <div class="text-3xl pt-8">Cosas importantes a tener en cuenta</div>
  <div class="text-2xl pt-4">1. Propiedades</div>
  <div class="text-xl pt-4 font-extralight">Si en tu base de datos de Notion las propiedades tienen nombres diferentes o est√°n configuradas de manera distinta habr√° errores, aseg√∫rate de ajustar las propiedades con el mismo nombre y tipo que tienes en el c√≥digo.  </div>
  <div class="text-2xl pt-8">2. Convertir a kil√≥metros</div>
  <div class="text-xl pt-4 pb-4 font-extralight">Dado que la API de Strava nos devuelve la distancia en metros, puedes dividir esa distancia por 1000 para convertirla a kil√≥metros.</div>
  <ul class="text-xl ml-8 list-disc font-extralight">
    <li>Incluye la siguiente constante <code>const distanceInKilometers = activity.distance / 1000;</code> despu√©s de leer las actividades y antes de pintar las actividades en la base de datos de Notion.</li>
    <li class="mt-4">Redondear la cifra. Si quieres redondear la distancia a un n√∫mero de decimales espec√≠fico, puedes usar la funci√≥n <code>toFixed()</code>. Por ejemplo, para redondear a 2 decimales <code>const distanceInKilometers = parseFloat((activity.distance / 1000).toFixed(2));</code></li>
  </ul>
  <div class="text-2xl pt-8">3. Duplicados cada vez que se ejecuta el script</div>
  <div class="text-xl pt-4 pb-4 font-extralight">Esto ocurre, como es normal, si est√°s ejecutando el c√≥digo de forma costante y creando entradas de manera repetida para cada actividad de Strava, sin asegurarte antes de que no se est√©n creando duplicados en Notion. Para solucionarlo podemos hacer lo siguiente:</div>
  <div class="p-4 mb-8 bg-green-100 font-extralight rounded-lg">üìå A continuaci√≥n tienes los pasos, pero el c√≥digo completo del script lo puedes encontrar al final del post</div>
  <ul class="text-xl ml-4 list-none font-extralight">
    <li>1. Obtener el ID de la actividad desde Strava: Cada actividad de Strava tiene un <code>ID</code> √∫nico, y puedes usar este <code>ID</code> para asegurarte de que no est√°s agregando la misma actividad m√°s de una vez.</br>Crea una nueva entrada y propiedad como el resto de las veces anteriores, tanto en tu c√≥digo, como en la base de datos de Notion para tener controlado el n√∫mero de <code>ID</code>.</li>
    <li class=" pb-2 pt-2"><iframe style="width:100%; height:268px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Fquiqueciria%2Fcode-blocks%2Fblob%2Fmain%2Fstrava-id.js&style=default&type=code&showBorder=on&showLineNumbers=on&showFileMeta=on&showFullPath=on&showCopy=on"></iframe></li>
    <li class=" pb-2">2. En el bucle incluye <code>async</code> para realizar la consultas y escrituras de manera as√≠ncrona <code>activities.forEach(async (activity) => {</li></code>
    <li class=" pb-2 pt-2">3. Comprueba si la actividad ya est√° en Notion:</li>
    <li class=" pb-2 pt-2"><iframe style="width:100%; height:268px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Fquiqueciria%2Fcode-blocks%2Fblob%2Fmain%2Factivity-check.js&style=default&type=code&showBorder=on&showLineNumbers=on&showFileMeta=on&showFullPath=on&showCopy=on"></iframe></li>
    <li>4. Si no hay una entrada existente, crea una nueva.</li>
    <li><div class="code_block"> (existingPage.results.length === 0) {</div></li>
    <li class=" pb-2 pt-2"><iframe style="width:100%; height:793px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Fquiqueciria%2Fcode-blocks%2Fblob%2Fmain%2Fcreate_db_notion.js&style=default&type=code&showBorder=on&showLineNumbers=on&showFileMeta=on&showFullPath=on&showCopy=on"></iframe></li>
  </ul>
  <div class="text-3xl pt-4">El c√≥digo del script completo</div>
  <div class="text-xl pt-4 font-extralight">Este es el c√≥digo final del sript que cada vez ejecutemos desde el terminal nos actualizar√° si tenemos alguna actividad nueva desde Strava a Notion.</div>
  <div class=" pb-2 pt-2"><iframe style="width:100%; height:1822px;" allow="clipboard-write" src="https://emgithub.com/iframe.html?target=https%3A%2F%2Fgithub.com%2Fquiqueciria%2Fcode-blocks%2Fblob%2Fmain%2Fsync-strava.js&style=default&type=code&showBorder=on&showLineNumbers=on&showFileMeta=on&showFullPath=on&showCopy=on"></iframe></div>
  <div class="text-xl pb-4 font-extralight">En el siguiente post veremos como automatizar todo este proceso con Github Action y as√≠ "olvidarnos" de la ejecuci√≥n manual.</div>
<div class="text-xl pt-2 mb-4 font-extralight">
Si quieres comentar algo sobre este post o cualquier duda puedes hacerlo en el siguiente hilo de Bluesky:
</div>
  <blockquote class="bluesky-embed" data-bluesky-uri="at://did:plc:fmtdax4ph3cv2dgyclytul7n/app.bsky.feed.post/3lh6rhq3lc22q" data-bluesky-cid="bafyreid5lcmorfddkpjwffmzr63ldmwv4pph7xaekk52mjnqrfjibzptpu"><p lang="es">He escrito el primer post de como estoy visualizando mi actividades de Strava en Notion a trav√©s de su API : www.quiqueciria.es/activities_s...<br><br><a href="https://bsky.app/profile/did:plc:fmtdax4ph3cv2dgyclytul7n/post/3lh6rhq3lc22q?ref_src=embed">[image or embed]</a></p>&mdash; Quique Ciria (<a href="https://bsky.app/profile/did:plc:fmtdax4ph3cv2dgyclytul7n?ref_src=embed">@quiqueci.bsky.social</a>) <a href="https://bsky.app/profile/did:plc:fmtdax4ph3cv2dgyclytul7n/post/3lh6rhq3lc22q?ref_src=embed">2 de febrero de 2025, 11:01</a></blockquote><script async src="https://embed.bsky.app/static/embed.js" charset="utf-8"></script>


<div class="border-t border-slate-400 my-8"></div>
<div>
  <a class="border-b pb-1 border-slate-800 hover:border-orange-400" href="/">Quique Ciria </a>‚Ä¢ 2025 ‚Ä¢ 
  <a class="border-b pb-1 border-slate-800 hover:border-orange-400" href="mailto:info@quiqueciria.es">info @ quiqueciria.es</a>
</div>
  </body>
</html>
